<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>斜率优化 DP 笔记 | ChungZH's Blog</title><meta property="og:site_name" content="ChungZH's Blog"><meta property="og:title" content="斜率优化 DP 笔记 | ChungZH's Blog"><meta itemprop=name content="斜率优化 DP 笔记 | ChungZH's Blog"><meta name=twitter:title content="斜率优化 DP 笔记 | ChungZH's Blog"><meta name=application-name content="斜率优化 DP 笔记 | ChungZH's Blog"><link rel="shortcut icon" href=/BlogFavicon16.png><meta name=twitter:card content="summary"><meta name=description content="Welcome to my blog!"><meta name=twitter:description content="Welcome to my blog!"><meta itemprop=description content="Welcome to my blog!"><meta property="og:description" content="Welcome to my blog!"><link rel=stylesheet href="https://blog.chungzh.cn/sass/main.min.7282f6bbf341e3d53b04c9caa46bee016e558c91f2f9e48deaa3383817abd770.css" integrity="sha256-coL2u/NB49U7BMnKpGvuAW5VjJHy+eSN6qM4OBer13A="></head><body class="bg-white dark:bg-slate-900 text-slate-500 dark:text-slate-400"><header class="sticky top-0 z-40"><div class="w-full backdrop-blur bg-white/80 dark:bg-slate-900/75 lg:border-b lg:border-slate-900/10 dark:border-slate-50/[0.06]"><div class="py-4 border-b border-slate-900/10 lg:px-8 lg:border-0 dark:border-slate-300/10 mx-4 lg:mx-0"><div class="px-20 relative flex flex-wrap justify-between"><div class="relative flex items-center"><a href=/><div class="flex gap-3 items-center text-xl font-bold text-slate-800 dark:text-slate-200"><img class="w-auto h-8" src=/BlogFavicon16.png title=logo>
<span class="hover:text-sky-500 dark:hover:text-sky-400">ChungZH's Blog</span></div></a></div><div class="relative flex items-center"><div class="flex gap-5 items-center leading-6 font-semibold text-slate-700 dark:text-slate-200"><a class="hover:text-sky-500 dark:hover:text-sky-400" href=/about/>关于</a>
<a class="hover:text-sky-500 dark:hover:text-sky-400" href=/categories/>分类</a>
<a class="hover:text-sky-500 dark:hover:text-sky-400" href=/friends/>友链</a>
<a class="hover:text-sky-500 dark:hover:text-sky-400" href=/archives/>存档</a>
<a class="hover:text-sky-500 dark:hover:text-sky-400" href=/tags/>标签</a></div></div></div></div></div></header><div class="max-w-3xl mx-auto pb-28"><main class="max-w-[52rem] mx-auto py-10"><div class=container><article><header class=article-header><div class=thumb><div><div class=post-tags><a class=tag href=/tags/oi/>#OI</a>
<a class=tag href=/tags/%E7%AE%97%E6%B3%95/>#算法</a>
<a class=tag href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/>#数据结构</a>
<a class=tag href=/tags/%E6%95%B0%E5%AD%A6/>#数学</a>
<a class=tag href=/tags/dp/>#DP</a>
<a class=tag href=/tags/dp-%E4%BC%98%E5%8C%96/>#DP 优化</a>
<a class=tag href=/tags/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/>#斜率优化</a></div><h1 class=post-title>斜率优化 DP 笔记</h1><div class=post-meta>By ChungZH<div class="font-bold text-sky-500 dark:text-sky-400">·</div><time>August 13, 2022</time><div class="font-bold text-sky-500 dark:text-sky-400">·</div>7 minutes</div></div></div></header></article><aside class=toc><nav id=TableOfContents><ul><li><a href=#例题-hnoi2008玩具装箱>例题 [HNOI2008]玩具装箱</a><ul><li><a href=#题目描述>题目描述</a></li><li><a href=#朴素-dp-做法>朴素 DP 做法</a></li><li><a href=#优化>优化</a></li></ul></li><li><a href=#例题-apio2010-特别行动队>例题 [APIO2010] 特别行动队</a><ul><li><a href=#题目描述-1>题目描述</a></li><li><a href=#分析>分析</a></li></ul></li></ul></nav></aside><div class=article-post><h2 id=例题-hnoi2008玩具装箱><a href=#%e4%be%8b%e9%a2%98-hnoi2008%e7%8e%a9%e5%85%b7%e8%a3%85%e7%ae%b1 class=anchor><svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>例题 [HNOI2008]玩具装箱</h2><p><a href=https://www.luogu.com.cn/problem/P3195>Luogu</a> <a href=https://loj.ac/p/10188>LOJ</a></p><h3 id=题目描述><a href=#%e9%a2%98%e7%9b%ae%e6%8f%8f%e8%bf%b0 class=anchor><svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>题目描述</h3><p>P 教授要去看奥运，但是他舍不下他的玩具，于是他决定把所有的玩具运到北京。他使用自己的压缩器进行压缩，其可以将任意物品变成一堆，再放到一种特殊的一维容器中。</p><p>P 教授有编号为 $1 \cdots n$ 的 $n$ 件玩具，第 $i$ 件玩具经过压缩后的一维长度为 $C_i$。</p><p>为了方便整理，P 教授要求：</p><ul><li><p>在一个一维容器中的玩具编号是连续的。</p></li><li><p>同时如果一个一维容器中有多个玩具，那么两件玩具之间要加入一个单位长度的填充物。形式地说，如果将第 $i$ 件玩具到第 $j$ 个玩具放到一个容器中，那么容器的长度将为 $x=j-i+\sum\limits_{k=i}^{j}C_k$。</p></li></ul><p>制作容器的费用与容器的长度有关，根据教授研究，如果容器长度为 $x$，其制作费用为 $(x-L)^2$。其中 $L$ 是一个常量。P 教授不关心容器的数目，他可以制作出任意长度的容器，甚至超过 $L$。但他希望所有容器的总费用最小。</p><p>$1 \leq n \leq 5 \times 10^4$，$1 \leq L \leq 10^7$，$1 \leq C_i \leq 10^7$。</p><h3 id=朴素-dp-做法><a href=#%e6%9c%b4%e7%b4%a0-dp-%e5%81%9a%e6%b3%95 class=anchor><svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>朴素 DP 做法</h3><p>令状态 $f(i)$ 表示把前 $i$ 个玩具装箱的最小费用，$s(i)$ 为 $c_i$ 的前缀和。</p><p>假如将玩具 $j$ 到 $i$ 装在同一箱子，容易列出状态转移方程 $f(i) = \min_{1\le j\le i}{f(j-1)+(i-j+s(i)-s(j-1)-L)^2}$。</p><p>直接算的话时间复杂度是 $O(n^2)$，超时。</p><h3 id=优化><a href=#%e4%bc%98%e5%8c%96 class=anchor><svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>优化</h3><p>在计算过程中，$i, s(i), L$ 这些项是已知的，而含有 $j$ 的项如 $f(j-1), j, s(j-1)$ 都是未知的。展开平方式，进行参数分离，定义 $g(i) = i+s(i)-L$，$x(j) = j+s(j-1)$。可选决策 $j$ 的费用记为 $f(i)_j$，则有</p><p>$$
f(i)_j = f(j-1)+(g(i)-x(j))^2 = f(j-1) + g(i)^2 - 2 \times g(i) \times x(j) + x(j)^2
$$</p><p>式子中 $f(j-1), g(i)^2, x(j)^2$ 这三项中 $i$ 与 $j$ 这两个参数完全分离，但 $2 \times g(i) \times x(j)$ 却没有分离，不像普通单调队列优化的题目那样 「$j_2 > j_1, f(i)<em>{j</em>{2}} &lt; f(i)<em>{j</em>{1}}$，$j_1$ 就可以删除」这么明显的单调性，需要深入分析。</p><p><strong>研究 $j_2 > j_1$ 时 $f(i)<em>{j</em>{2}} &lt; f(i)<em>{j</em>{1}}$ 即「决策 $j_2$ 优于 决策 $j_1$」的前提条件</strong>：</p><p>$$
f(j_2-1) + g(i)^2 - 2 \times g(i) \times x(j_2) + x(j_2)^2 &lt; f(j_1-1) + g(i)^2 - 2 \times g(i) \times x(j_1) + x(j_1)^2
\
(f(j_2-1) + x(j_2)^2) - (f(j_1-1) + x(j_1)^2) &lt; 2 \times g(i) \times (x(j_2) - x(j_1))
$$</p><p>再令 $y(i) = f(i-1)+x(i)^2$，因 $x(i) = i+s(i-1)$ 是单调递增的，所以 $x(j_2)-x(j_1) > 0$，所以有</p><p>$$
\frac{y(j_2) - y(j_1)}{x(j_2)-x(j_1)} &lt; 2 \times g(i)
$$</p><p>上面式子像 $j_1, j_2$ 两个点形成的斜率，于是用 <strong>斜率优化</strong>。</p><p><strong>斜率优化</strong>：计算 $f(i)$ 时，可选决策 $j_2 > j_1$，如果 $j_2$ 比 $j_1$ 优，令 $T(j_1, j_2) = \frac{y(j_2)-y(j_1)}{x(j_2)-x(j_1)}$，则必须满足 $T(j_1, j_2) &lt; 2 \times g(i)$。</p><p>该题 $x(i), g(i)$ 都是单调上升的。下面有两个重要结论：</p><ol><li><p>计算 $f(i)$ 时，所有可选决策是 $1, \cdots, i$，可以删除其中的冗余决策，使得队列中从小到大依次存储有价值的可选决策 $j_1, j_2, \cdots, j_k$，使得这些相邻决策之间的斜率都要大于 $2 \times g(i)$。即： $T(j_1, j_2) > 2 \times g(i), T(j_2, j_3) > 2 \times g(i), \cdots, T(j_{k-1}, j_k) > 2 \times g(i)$。最优决策是队首元素 $j_1$。</p><p>证明：如果队列中相邻两个决策 $x, y$ 之间的斜率 $T(x, y) &lt; 2 \times g(i)$，由于 $g(i)$ 是单调增的，则对于后面的 $i_1(i_1 > i)$，计算 $f(i_1)$ 时，有：$T(x, y) &lt; 2 \times g(i) &lt; 2 \times g(i_1)$，所以 $y$ 永远比 $x$ 优，$x$ 可以删除。所以 $T(j_1, j_2) > 2 \times g(i), T(j_2, j_3) > 2 \times g(i), \cdots, T(j_{k-1}, j_k) > 2 \times g(i)$。则对于 $f(i)$ 来说，$j_1$ 比 $j_2$ 优，$j_2$ 比 $j_3$ 优，&mldr;，$j_{k-1}$ 比 $j_k$ 优，所以<strong>队首 $j_1$ 是最优的</strong>。并且在 $f(i+1)$ 时可以在之前维护的队列基础上加入新的决策 $i+1$，再继续维护。</p></li><li><p>可以维护相邻决策之间的斜率单调增。</p><p>证明：设队列中三个相邻决策 $j_1, j_2, j_3$，假设出现相邻斜率单调递减的情况，即 $T(j_1, j_2) > T(j_2, j_3)$，分析 $j_2$ 有没有可能在计算 $f$ 的过程中成为最优决策。</p><p>$$
j_2 比 j_1 优 \Rightarrow T(j_1, j_2) &lt; 2 \times g(i)
\
j_2 比 j_3 优 \Rightarrow T(j_2, j_3) > 2 \times g(i)
\
T(j_1, j_2) &lt; 2 \times g(i) &lt; T(j_2, j_3)
$$</p><p>矛盾。所以 $j_2$ 不可能成为最优决策，可以删除。得证。</p></li></ol><p>综上：</p><ol><li>应该维护队列中相邻决策满足：$2 \times g(i) &lt; T(j_1, j_2) &lt; T(j_2, j_3) &lt; \cdots &lt; T(j_{k-1}, j_k)$。</li><li>最优决策取队首元素。</li></ol><p><strong>程序实现</strong>：</p><ol><li><strong>删尾</strong>：要插入新的可选决策 $i$，每次选队列最后两个决策 $j_{k-1}, j_k$，如果 $T(j_{k-1}, j_k) > T(j_k, i)$，则删除队尾元素 $j_k$。循环做下去，直到队列中的元素个数小于 $2$ 或者 $T(j_{k-1}, j_k)&lt;T(j_k, i)$；</li><li><strong>插入</strong>：把新的可选决策 $i$ 加入队尾；</li><li><strong>删头</strong>：取队首两个决策 $j_1, j_2$，如果 $T(j_1, j_2) &lt; 2 \times g(i)$，则删除队首元素 $j_1$。如此循环下去，直到队列中元素个数小于 $2$ 或者 $T(j_1, j_2) > 2 \times g(i)$；</li><li><strong>取头</strong>：最优决策在队首。</li></ol><p>时间复杂度是 $O(n)$。</p><p><a href=https://www.luogu.com.cn/record/83528457>RECORD</a></p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;bits/stdc++.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>using</span> <span style=color:#00a8c8>namespace</span> <span style=color:#111>std</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define LL long long
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>int</span> <span style=color:#111>n</span><span style=color:#111>,</span> <span style=color:#111>L</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#ae81ff>50050</span><span style=color:#111>],</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#ae81ff>50050</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>int</span> <span style=color:#111>head</span><span style=color:#111>,</span> <span style=color:#111>tail</span><span style=color:#111>,</span> <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#ae81ff>50050</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#75af00>x</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>)</span> <span style=color:#111>{</span> <span style=color:#00a8c8>return</span> <span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>];</span> <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#75af00>y</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>)</span> <span style=color:#111>{</span> <span style=color:#00a8c8>return</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span><span style=color:#f92672>+</span><span style=color:#111>x</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>x</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>);</span> <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#75af00>g</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>)</span> <span style=color:#111>{</span> <span style=color:#00a8c8>return</span> <span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#111>L</span><span style=color:#111>;</span> <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>double</span> <span style=color:#75af00>T</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span> <span style=color:#111>j</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#00a8c8>double</span><span style=color:#111>)(</span><span style=color:#111>y</span><span style=color:#111>(</span><span style=color:#111>j</span><span style=color:#111>)</span><span style=color:#f92672>-</span><span style=color:#111>y</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>))</span><span style=color:#f92672>/</span><span style=color:#111>(</span><span style=color:#111>x</span><span style=color:#111>(</span><span style=color:#111>j</span><span style=color:#111>)</span><span style=color:#f92672>-</span><span style=color:#111>x</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>));</span> 
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#75af00>cost</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span> <span style=color:#111>j</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#111>abs</span><span style=color:#111>((</span><span style=color:#111>j</span><span style=color:#f92672>-</span><span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>j</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#111>L</span><span style=color:#111>)</span><span style=color:#f92672>*</span><span style=color:#111>(</span><span style=color:#111>j</span><span style=color:#f92672>-</span><span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>j</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#111>L</span><span style=color:#111>));</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>int</span> <span style=color:#75af00>main</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#111>cin</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>n</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>L</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span> <span style=color:#111>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>n</span><span style=color:#111>;</span> <span style=color:#111>i</span><span style=color:#f92672>++</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#111>cin</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span>		<span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span> <span style=color:#f92672>+=</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>head</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>	<span style=color:#111>tail</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>for</span> <span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span> <span style=color:#111>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>n</span><span style=color:#111>;</span> <span style=color:#111>i</span><span style=color:#f92672>++</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>while</span> <span style=color:#111>(</span><span style=color:#111>head</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>tail</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#111>T</span><span style=color:#111>(</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>tail</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>],</span> <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>tail</span><span style=color:#111>])</span> <span style=color:#f92672>&gt;</span> <span style=color:#111>T</span><span style=color:#111>(</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>tail</span><span style=color:#111>],</span> <span style=color:#111>i</span><span style=color:#111>))</span> <span style=color:#111>tail</span><span style=color:#f92672>--</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>		<span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#f92672>++</span><span style=color:#111>tail</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>i</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>while</span> <span style=color:#111>(</span><span style=color:#111>head</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>tail</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#111>T</span><span style=color:#111>(</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>head</span><span style=color:#111>],</span> <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>head</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#111>])</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>*</span><span style=color:#111>g</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>))</span> <span style=color:#111>head</span><span style=color:#f92672>++</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>		<span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>head</span><span style=color:#111>]</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span><span style=color:#f92672>+</span><span style=color:#111>cost</span><span style=color:#111>(</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>head</span><span style=color:#111>],</span> <span style=color:#111>i</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>	<span style=color:#111>cout</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>n</span><span style=color:#111>]</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#111>endl</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>return</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=例题-apio2010-特别行动队><a href=#%e4%be%8b%e9%a2%98-apio2010-%e7%89%b9%e5%88%ab%e8%a1%8c%e5%8a%a8%e9%98%9f class=anchor><svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>例题 [APIO2010] 特别行动队</h2><p><a href=https://www.luogu.com.cn/problem/P3628>Luogu</a> <a href=https://loj.ac/p/10190>LOJ</a></p><h3 id=题目描述-1><a href=#%e9%a2%98%e7%9b%ae%e6%8f%8f%e8%bf%b0-1 class=anchor><svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>题目描述</h3><p>你有一支由 $n$ 名预备役士兵组成的部队，士兵从 $1$ 到 $n$ 编号，你要将他们拆分成若干特别行动队调入战场。出于默契的考虑，同一支特别行动队中队员的编号<strong>应该连续</strong>，即为形如 $(i, i + 1, \cdots i + k)$的序列。所有的队员都应该属于且仅属于一支特别行动队。</p><p>编号为 $i$ 的士兵的初始战斗力为 $x_i$ ，一支特别行动队的初始战斗力 $X$ 为队内士兵初始战斗力之和，即 $X = x_i + x_{i+1} + \cdots + x_{i+k}$。</p><p>通过长期的观察，你总结出对于一支初始战斗力为 $X$ 的特别行动队，其修正战斗力 $X&rsquo;= aX^2+bX+c$，其中 $a,~b,~c$ 是已知的系数（$a &lt; 0$）。 作为部队统帅，现在你要为这支部队进行编队，使得所有特别行动队的修正战斗力之和最大。试求出这个最大和。</p><p>$1 \leq n \leq 10^6$，$-5 \leq a \leq -1$，$-10^7 \leq b \leq 10^7$，$-10^7 \leq c \leq 10^7$，$1 \leq x_i \leq 100$。</p><h3 id=分析><a href=#%e5%88%86%e6%9e%90 class=anchor><svg class="icon" aria-hidden="true" focusable="false" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>分析</h3><p>令 $f(i)$ 表示把前 $i$ 个士兵编队的最大修正战斗力之和，$s(i)$ 表示 $x_i$ 的前缀和。</p><p>假如将士兵 $j$ 到 $i$ 编在同一队，得出状态转移方程 $f(i) = \max_{1\le j\le i}{f(j-1) + a\times (s(i)-s(j-1))^2 + b\times (s(i)-s(j-1)) + c}$。</p><p>展开后得出</p><p>$$
f(i) = \max_{1\le j\le i}{f(j-1) + a \times s(i)^2 + a \times s(j-1)^2 - 2a \times s(i) \times s(j-1) + b \times s(i) - b \times s(j-1) + c }
\
f(i) = \max_{1\le j\le i}{f(j-1) + a \times (s(i)^2 + s(j-1)^2) - 2a \times s(i) \times s(j-1) + b \times (s(i) - s(j-1)) + c }
$$</p><p><strong>研究 $j_2 > j_1$ 时 $f(i)<em>{j</em>{2}} > f(i)<em>{j</em>{1}}$ 即「决策 $j_2$ 优于 决策 $j_1$」的前提条件</strong>：</p><p>$$
f(j_2-1) + a \times (s(i)^2 + s(j_2-1)^2) - 2a \times s(i) \times s(j_2-1) + b \times (s(i) - s(j_2-1)) + c > f(j_1-1) + a \times (s(i)^2 + s(j_1-1)^2) - 2a \times s(i) \times s(j_1-1) + b \times (s(i) - s(j_1-1)) + c
\
f(j_2-1) - f(j_1-1) + a \times (s(i_2-1)^2 - s(j_1-1)^2) - b \times (s(j_2-1) - s(j_1-1)) > 2a \times s(i) \times (s(j_2-1) - s(j_1-1))
\
\frac{f(j_2-1) - f(j_1-1) + a \times (s(i_2-1)^2 - s(j_1-1)^2) - b \times (s(j_2-1) - s(j_1-1))}{s(j_2-1) - s(j_1-1)} > 2a \times s(i)
$$</p><p>令 $g(i) = f(i-1) + a \times s(i-1)^2 - b \times s(i-1)$，则有</p><p>$$
\frac{g(j_2)-g(j_1)}{s(j_2-1) - s(j_1-1)} > 2a \times s(i)
$$</p><p>上面式子就是 $(s(j_1-1), g(j_1)), (s(j_2-1), g(j_2))$ 两个点形成的斜率。</p><p>小结：计算 $f(i)$ 时，可选决策 $j_2 > j_1$，令 $T(j_1, j_2)=\frac{g(j_2)-g(j_1)}{s(j_2-1) - s(j_1-1)}$，如果 $j_2$ 比 $j_1$ 优，必须满足 $T(j_1, j_2) > 2a \times s(i)$。</p><p>该题 $s(i)$ 单调增，可以得出两个结论：</p><ol><li><p>计算 $f(i)$ 时，可以删除冗余决策，使得队列中从小到大依次存储有价值的可选决策 $j_1, j_2, \cdots, j_k$，使得这些相邻决策之间的斜率都要小于 $2a \times s(i)$。即： $T(j_1, j_2) &lt; 2a \times s(i), T(j_2, j_3) &lt; 2a \times s(i), \cdots, T(j_{k-1}, j_k) &lt; 2a \times s(i)$。最优决策是队首元素 $j_1$。</p><p>证明：对于队列中两个相邻决策 $x, y$，如果 $T(x, y) > 2a \times s(i)$，由于 $s(i)$ 单调增，且题目中规定 $a &lt; 0$，所以 $2a \times s(i)$ 单调下降，所以对于 $i_1 > i$ 有 $T(x, y) > 2a \times s(i) > 2a \times s(i_1)$，$y$ 永远比 $x$ 优，所以 $x$ 可以删除。所以 $T(j_1, j_2) &lt; 2a \times s(i), T(j_2, j_3) &lt; 2a \times s(i), \cdots, T(j_{k-1}, j_k) &lt; 2a \times s(i)$，$j_1$ 比 $j_2$ 优，$j_2$ 比 $j_3$ 优，&mldr;，$j_k-1$ 比 $j_k$ 优。所以队首元素 $j_1$ 是最优的。</p></li><li><p>可以维护相邻决策之间的斜率单调减。</p><p>证明：设队列中三个相邻决策 $j_1, j_2, j_3$，假设出现单调增即 $T(j_1, j_2) &lt; T(j_2, j_3)$，分析 $j_2$ 有没有可能成为最优决策。</p><p>$$
j_2 比 j_1 优 \Rightarrow T(j_1, j_2) > 2a \times s(i)
\
j_2 比 j_3 优 \Rightarrow T(j_2, j_3) &lt; 2a \times s(i)
\
T(j_2, j_3) &lt; 2a \times s(i) &lt; T(j_1, j_2)
$$</p><p>矛盾。$j_2$ 不可能成为最优决策，可以删除。得证。</p></li></ol><p>综上：</p><ol><li>应该维护队列中相邻决策满足：$T(j_1, j_2) > T(j_2, j_3) > \cdots > T(j_{k-1}, j_k) > 2a \times s(i)$。</li><li>最优决策取队首元素。</li></ol><p><a href=https://www.luogu.com.cn/record/83587373>RECORD</a></p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;bits/stdc++.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>using</span> <span style=color:#00a8c8>namespace</span> <span style=color:#111>std</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define LL long long
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>int</span> <span style=color:#111>n</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#111>a</span><span style=color:#111>,</span> <span style=color:#111>b</span><span style=color:#111>,</span> <span style=color:#111>c</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>int</span> <span style=color:#111>st</span><span style=color:#111>,</span> <span style=color:#111>en</span><span style=color:#111>,</span> <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#ae81ff>1000006</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#ae81ff>1000006</span><span style=color:#111>],</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#ae81ff>1000006</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#75af00>g</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>i</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>+</span> <span style=color:#111>a</span> <span style=color:#f92672>*</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>*</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>-</span> <span style=color:#111>b</span> <span style=color:#f92672>*</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>double</span> <span style=color:#75af00>T</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span> <span style=color:#111>j</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#111>g</span><span style=color:#111>(</span><span style=color:#111>j</span><span style=color:#111>)</span> <span style=color:#f92672>-</span> <span style=color:#111>g</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>))</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> <span style=color:#111>(</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>j</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>-</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>])</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.0</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>LL</span> <span style=color:#75af00>cost</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span> <span style=color:#111>j</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>a</span> <span style=color:#f92672>*</span> <span style=color:#111>(</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span> <span style=color:#f92672>-</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>j</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>])</span> <span style=color:#f92672>*</span> <span style=color:#111>(</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span> <span style=color:#f92672>-</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>j</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>])</span> <span style=color:#f92672>+</span> <span style=color:#111>b</span> <span style=color:#f92672>*</span> <span style=color:#111>(</span><span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span> <span style=color:#f92672>-</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>j</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>])</span> <span style=color:#f92672>+</span> <span style=color:#111>c</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>int</span> <span style=color:#75af00>main</span><span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#111>cin</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>n</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>a</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>b</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>c</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>for</span> <span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span> <span style=color:#111>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>n</span><span style=color:#111>;</span> <span style=color:#111>i</span><span style=color:#f92672>++</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#111>cin</span> <span style=color:#f92672>&gt;&gt;</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span>        <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span> <span style=color:#f92672>+=</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>    <span style=color:#111>st</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#111>en</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>for</span> <span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span> <span style=color:#111>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>n</span><span style=color:#111>;</span> <span style=color:#111>i</span><span style=color:#f92672>++</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>while</span> <span style=color:#111>(</span><span style=color:#111>st</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>en</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#111>T</span><span style=color:#111>(</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>en</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>],</span> <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>en</span><span style=color:#111>])</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>T</span><span style=color:#111>(</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>en</span><span style=color:#111>],</span> <span style=color:#111>i</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>            <span style=color:#111>en</span><span style=color:#f92672>--</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>        <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#f92672>++</span><span style=color:#111>en</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>i</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>while</span> <span style=color:#111>(</span><span style=color:#111>st</span> <span style=color:#f92672>&lt;=</span> <span style=color:#111>en</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#111>T</span><span style=color:#111>(</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>st</span><span style=color:#111>],</span> <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>st</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#111>])</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#111>a</span> <span style=color:#f92672>*</span> <span style=color:#111>s</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>])</span>
</span></span><span style=display:flex><span>            <span style=color:#111>st</span><span style=color:#f92672>++</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>        <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>st</span><span style=color:#111>]</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span><span style=color:#111>]</span> <span style=color:#f92672>+</span> <span style=color:#111>cost</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>,</span> <span style=color:#111>Q</span><span style=color:#111>[</span><span style=color:#111>st</span><span style=color:#111>]);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>    <span style=color:#111>cout</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#111>dp</span><span style=color:#111>[</span><span style=color:#111>n</span><span style=color:#111>]</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#111>endl</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>实现时要注意</strong>：在计算斜率的函数 <code>double T()</code> 中，一定要用 <code>(double)</code> 或者 <code>*1.0</code>，将 <code>long long</code> 变成 <code>double</code> 类型之后再计算！！！！！</p><p><strong>实现时要注意</strong>：在计算斜率的函数 <code>double T()</code> 中，一定要用 <code>(double)</code> 或者 <code>*1.0</code>，将 <code>long long</code> 变成 <code>double</code> 类型之后再计算！！！！！</p><p><strong>实现时要注意</strong>：在计算斜率的函数 <code>double T()</code> 中，一定要用 <code>(double)</code> 或者 <code>*1.0</code>，将 <code>long long</code> 变成 <code>double</code> 类型之后再计算！！！！！</p><hr><p>致谢：</p><ul><li>lgj</li></ul><p>🙇‍</p></div><div class=paginav><a rel=prev href=/articles/centroid-decomposition/ title="Previous post (older)"><span>Prev</span><div class=paginav-title>点分治笔记</div></a></div></div><div class=container><script src=https://giscus.app/client.js data-repo=ChungZH/ChungZH.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxNzcxMjMzNjI=" data-category=Comments data-category-id=DIC_kwDOCo6wIs4B_i5g data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-theme=light crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector(".giscus iframe");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}const colorSchemeQueryList=window.matchMedia("(prefers-color-scheme: dark)"),setColorScheme=e=>{setGiscusTheme(e.matches?"dark_dimmed":"light")};setColorScheme(colorSchemeQueryList),colorSchemeQueryList.addEventListener("change",setColorScheme)</script></div></main><footer class="text-sm leading-6 mt-10"><div class="pt-10 pb-28 border-t border-slate-200 sm:flex justify-between text-slate-500 dark:border-slate-200/5"><div class="mb-6 sm:mb-0 sm:flex"><p>Made with ❤</p><p class="sm:ml-4 sm:pl-4 sm:border-l sm:border-slate-200 dark:sm:border-slate-200/5">By
<a class="hover:text-slate-900 dark:hover:text-slate-400" href=https://github.com/ChungZH>ChungZH</a></p><p class="sm:ml-4 sm:pl-4 sm:border-l sm:border-slate-200 dark:sm:border-slate-200/5">Theme hugo-klay</p></div></div></footer></div></body></html>