---
title: æ–œç‡ä¼˜åŒ– DP ç¬”è®°
tags:
- OI
- ç®—æ³•
- æ•°æ®ç»“æ„
- æ•°å­¦
- DP
- DP ä¼˜åŒ–
- æ–œç‡ä¼˜åŒ–
categories: å­¦ä¹ ç¬”è®°
katex: true
date: 2022-08-13 21:59
---

## ä¾‹é¢˜ [HNOI2008]ç©å…·è£…ç®±

[Luogu](https://www.luogu.com.cn/problem/P3195) [LOJ](https://loj.ac/p/10188)

### é¢˜ç›®æè¿°

P æ•™æˆè¦å»çœ‹å¥¥è¿ï¼Œä½†æ˜¯ä»–èˆä¸ä¸‹ä»–çš„ç©å…·ï¼Œäºæ˜¯ä»–å†³å®šæŠŠæ‰€æœ‰çš„ç©å…·è¿åˆ°åŒ—äº¬ã€‚ä»–ä½¿ç”¨è‡ªå·±çš„å‹ç¼©å™¨è¿›è¡Œå‹ç¼©ï¼Œå…¶å¯ä»¥å°†ä»»æ„ç‰©å“å˜æˆä¸€å †ï¼Œå†æ”¾åˆ°ä¸€ç§ç‰¹æ®Šçš„ä¸€ç»´å®¹å™¨ä¸­ã€‚

P æ•™æˆæœ‰ç¼–å·ä¸º $1 \cdots n$ çš„ $n$ ä»¶ç©å…·ï¼Œç¬¬ $i$ ä»¶ç©å…·ç»è¿‡å‹ç¼©åçš„ä¸€ç»´é•¿åº¦ä¸º $C_i$ã€‚

ä¸ºäº†æ–¹ä¾¿æ•´ç†ï¼ŒP æ•™æˆè¦æ±‚ï¼š

- åœ¨ä¸€ä¸ªä¸€ç»´å®¹å™¨ä¸­çš„ç©å…·ç¼–å·æ˜¯è¿ç»­çš„ã€‚

- åŒæ—¶å¦‚æœä¸€ä¸ªä¸€ç»´å®¹å™¨ä¸­æœ‰å¤šä¸ªç©å…·ï¼Œé‚£ä¹ˆä¸¤ä»¶ç©å…·ä¹‹é—´è¦åŠ å…¥ä¸€ä¸ªå•ä½é•¿åº¦çš„å¡«å……ç‰©ã€‚å½¢å¼åœ°è¯´ï¼Œå¦‚æœå°†ç¬¬ $i$ ä»¶ç©å…·åˆ°ç¬¬ $j$ ä¸ªç©å…·æ”¾åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œé‚£ä¹ˆå®¹å™¨çš„é•¿åº¦å°†ä¸º $x=j-i+\sum\limits_{k=i}^{j}C_k$ã€‚

åˆ¶ä½œå®¹å™¨çš„è´¹ç”¨ä¸å®¹å™¨çš„é•¿åº¦æœ‰å…³ï¼Œæ ¹æ®æ•™æˆç ”ç©¶ï¼Œå¦‚æœå®¹å™¨é•¿åº¦ä¸º $x$ï¼Œå…¶åˆ¶ä½œè´¹ç”¨ä¸º $(x-L)^2$ã€‚å…¶ä¸­ $L$ æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚P æ•™æˆä¸å…³å¿ƒå®¹å™¨çš„æ•°ç›®ï¼Œä»–å¯ä»¥åˆ¶ä½œå‡ºä»»æ„é•¿åº¦çš„å®¹å™¨ï¼Œç”šè‡³è¶…è¿‡ $L$ã€‚ä½†ä»–å¸Œæœ›æ‰€æœ‰å®¹å™¨çš„æ€»è´¹ç”¨æœ€å°ã€‚

$1 \leq n \leq 5 \times 10^4$ï¼Œ$1 \leq L \leq 10^7$ï¼Œ$1 \leq C_i \leq 10^7$ã€‚

### æœ´ç´  DP åšæ³•

ä»¤çŠ¶æ€ $f(i)$ è¡¨ç¤ºæŠŠå‰ $i$ ä¸ªç©å…·è£…ç®±çš„æœ€å°è´¹ç”¨ï¼Œ$s(i)$ ä¸º $c_i$ çš„å‰ç¼€å’Œã€‚

å‡å¦‚å°†ç©å…· $j$ åˆ° $i$ è£…åœ¨åŒä¸€ç®±å­ï¼Œå®¹æ˜“åˆ—å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ $f(i) = \min_{1\le j\le i}\{f(j-1)+(i-j+s(i)-s(j-1)-L)^2\}$ã€‚

ç›´æ¥ç®—çš„è¯æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n^2)$ï¼Œè¶…æ—¶ã€‚

### ä¼˜åŒ–

åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œ$i, s(i), L$ è¿™äº›é¡¹æ˜¯å·²çŸ¥çš„ï¼Œè€Œå«æœ‰ $j$ çš„é¡¹å¦‚ $f(j-1), j, s(j-1)$ éƒ½æ˜¯æœªçŸ¥çš„ã€‚å±•å¼€å¹³æ–¹å¼ï¼Œè¿›è¡Œå‚æ•°åˆ†ç¦»ï¼Œå®šä¹‰ $g(i) = i+s(i)-L$ï¼Œ$x(j) = j+s(j-1)$ã€‚å¯é€‰å†³ç­– $j$ çš„è´¹ç”¨è®°ä¸º $f(i)_j$ï¼Œåˆ™æœ‰ 

$$
f(i)_j = f(j-1)+(g(i)-x(j))^2 = f(j-1) + g(i)^2 - 2 \times g(i) \times x(j) + x(j)^2
$$

å¼å­ä¸­ $f(j-1), g(i)^2, x(j)^2$ è¿™ä¸‰é¡¹ä¸­ $i$ ä¸ $j$ è¿™ä¸¤ä¸ªå‚æ•°å®Œå…¨åˆ†ç¦»ï¼Œä½† $2 \times g(i) \times x(j)$ å´æ²¡æœ‰åˆ†ç¦»ï¼Œä¸åƒæ™®é€šå•è°ƒé˜Ÿåˆ—ä¼˜åŒ–çš„é¢˜ç›®é‚£æ · ã€Œ$j_2 > j_1, f(i)_{j_{2}} < f(i)_{j_{1}}$ï¼Œ$j_1$ å°±å¯ä»¥åˆ é™¤ã€è¿™ä¹ˆæ˜æ˜¾çš„å•è°ƒæ€§ï¼Œéœ€è¦æ·±å…¥åˆ†æã€‚

**ç ”ç©¶ $j_2 > j_1$ æ—¶ $f(i)_{j_{2}} < f(i)_{j_{1}}$ å³ã€Œå†³ç­– $j_2$ ä¼˜äº å†³ç­– $j_1$ã€çš„å‰ææ¡ä»¶**ï¼š

$$
f(j_2-1) + g(i)^2 - 2 \times g(i) \times x(j_2) + x(j_2)^2 < f(j_1-1) + g(i)^2 - 2 \times g(i) \times x(j_1) + x(j_1)^2
\\
(f(j_2-1) + x(j_2)^2) - (f(j_1-1) + x(j_1)^2) < 2 \times g(i) \times (x(j_2) - x(j_1))
$$

å†ä»¤ $y(i) = f(i-1)+x(i)^2$ï¼Œå›  $x(i) = i+s(i-1)$ æ˜¯å•è°ƒé€’å¢çš„ï¼Œæ‰€ä»¥ $x(j_2)-x(j_1) > 0$ï¼Œæ‰€ä»¥æœ‰

$$
\frac{y(j_2) - y(j_1)}{x(j_2)-x(j_1)} < 2 \times g(i)
$$

ä¸Šé¢å¼å­åƒ $j_1, j_2$ ä¸¤ä¸ªç‚¹å½¢æˆçš„æ–œç‡ï¼Œäºæ˜¯ç”¨ **æ–œç‡ä¼˜åŒ–**ã€‚

**æ–œç‡ä¼˜åŒ–**ï¼šè®¡ç®— $f(i)$ æ—¶ï¼Œå¯é€‰å†³ç­– $j_2 > j_1$ï¼Œå¦‚æœ $j_2$ æ¯” $j_1$ ä¼˜ï¼Œä»¤ $T(j_1, j_2) = \frac{y(j_2)-y(j_1)}{x(j_2)-x(j_1)}$ï¼Œåˆ™å¿…é¡»æ»¡è¶³ $T(j_1, j_2) < 2 \times g(i)$ã€‚

è¯¥é¢˜ $x(i), g(i)$ éƒ½æ˜¯å•è°ƒä¸Šå‡çš„ã€‚ä¸‹é¢æœ‰ä¸¤ä¸ªé‡è¦ç»“è®ºï¼š

1. è®¡ç®— $f(i)$ æ—¶ï¼Œæ‰€æœ‰å¯é€‰å†³ç­–æ˜¯ $1, \cdots, i$ï¼Œå¯ä»¥åˆ é™¤å…¶ä¸­çš„å†—ä½™å†³ç­–ï¼Œä½¿å¾—é˜Ÿåˆ—ä¸­ä»å°åˆ°å¤§ä¾æ¬¡å­˜å‚¨æœ‰ä»·å€¼çš„å¯é€‰å†³ç­– $j_1, j_2, \cdots, j_k$ï¼Œä½¿å¾—è¿™äº›ç›¸é‚»å†³ç­–ä¹‹é—´çš„æ–œç‡éƒ½è¦å¤§äº $2 \times g(i)$ã€‚å³ï¼š $T(j_1, j_2) > 2 \times g(i), T(j_2, j_3) > 2 \times g(i), \cdots, T(j_{k-1}, j_k) > 2 \times g(i)$ã€‚æœ€ä¼˜å†³ç­–æ˜¯é˜Ÿé¦–å…ƒç´  $j_1$ã€‚

    è¯æ˜ï¼šå¦‚æœé˜Ÿåˆ—ä¸­ç›¸é‚»ä¸¤ä¸ªå†³ç­– $x, y$ ä¹‹é—´çš„æ–œç‡ $T(x, y) < 2 \times g(i)$ï¼Œç”±äº $g(i)$ æ˜¯å•è°ƒå¢çš„ï¼Œåˆ™å¯¹äºåé¢çš„ $i_1(i_1 > i)$ï¼Œè®¡ç®— $f(i_1)$ æ—¶ï¼Œæœ‰ï¼š$T(x, y) < 2 \times g(i) < 2 \times g(i_1)$ï¼Œæ‰€ä»¥ $y$ æ°¸è¿œæ¯” $x$ ä¼˜ï¼Œ$x$ å¯ä»¥åˆ é™¤ã€‚æ‰€ä»¥ $T(j_1, j_2) > 2 \times g(i), T(j_2, j_3) > 2 \times g(i), \cdots, T(j_{k-1}, j_k) > 2 \times g(i)$ã€‚åˆ™å¯¹äº $f(i)$ æ¥è¯´ï¼Œ$j_1$ æ¯” $j_2$ ä¼˜ï¼Œ$j_2$ æ¯” $j_3$ ä¼˜ï¼Œ...ï¼Œ$j_{k-1}$ æ¯” $j_k$ ä¼˜ï¼Œæ‰€ä»¥**é˜Ÿé¦– $j_1$ æ˜¯æœ€ä¼˜çš„**ã€‚å¹¶ä¸”åœ¨ $f(i+1)$ æ—¶å¯ä»¥åœ¨ä¹‹å‰ç»´æŠ¤çš„é˜Ÿåˆ—åŸºç¡€ä¸ŠåŠ å…¥æ–°çš„å†³ç­– $i+1$ï¼Œå†ç»§ç»­ç»´æŠ¤ã€‚

2. å¯ä»¥ç»´æŠ¤ç›¸é‚»å†³ç­–ä¹‹é—´çš„æ–œç‡å•è°ƒå¢ã€‚

    è¯æ˜ï¼šè®¾é˜Ÿåˆ—ä¸­ä¸‰ä¸ªç›¸é‚»å†³ç­– $j_1, j_2, j_3$ï¼Œå‡è®¾å‡ºç°ç›¸é‚»æ–œç‡å•è°ƒé€’å‡çš„æƒ…å†µï¼Œå³ $T(j_1, j_2) > T(j_2, j_3)$ï¼Œåˆ†æ $j_2$ æœ‰æ²¡æœ‰å¯èƒ½åœ¨è®¡ç®— $f$ çš„è¿‡ç¨‹ä¸­æˆä¸ºæœ€ä¼˜å†³ç­–ã€‚

    $$
    j_2 æ¯” j_1 ä¼˜ \Rightarrow T(j_1, j_2) < 2 \times g(i)
    \\
    j_2 æ¯” j_3 ä¼˜ \Rightarrow T(j_2, j_3) > 2 \times g(i)
    \\
    T(j_1, j_2) < 2 \times g(i) < T(j_2, j_3)
    $$

    çŸ›ç›¾ã€‚æ‰€ä»¥ $j_2$ ä¸å¯èƒ½æˆä¸ºæœ€ä¼˜å†³ç­–ï¼Œå¯ä»¥åˆ é™¤ã€‚å¾—è¯ã€‚

ç»¼ä¸Šï¼š

1. åº”è¯¥ç»´æŠ¤é˜Ÿåˆ—ä¸­ç›¸é‚»å†³ç­–æ»¡è¶³ï¼š$2 \times g(i) < T(j_1, j_2) < T(j_2, j_3) < \cdots < T(j_{k-1}, j_k)$ã€‚
2. æœ€ä¼˜å†³ç­–å–é˜Ÿé¦–å…ƒç´ ã€‚

**ç¨‹åºå®ç°**ï¼š

1. **åˆ å°¾**ï¼šè¦æ’å…¥æ–°çš„å¯é€‰å†³ç­– $i$ï¼Œæ¯æ¬¡é€‰é˜Ÿåˆ—æœ€åä¸¤ä¸ªå†³ç­– $j_{k-1}, j_k$ï¼Œå¦‚æœ $T(j_{k-1}, j_k) > T(j_k, i)$ï¼Œåˆ™åˆ é™¤é˜Ÿå°¾å…ƒç´  $j_k$ã€‚å¾ªç¯åšä¸‹å»ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸ªæ•°å°äº $2$ æˆ–è€… $T(j_{k-1}, j_k)<T(j_k, i)$ï¼›
2. **æ’å…¥**ï¼šæŠŠæ–°çš„å¯é€‰å†³ç­– $i$ åŠ å…¥é˜Ÿå°¾ï¼›
3. **åˆ å¤´**ï¼šå–é˜Ÿé¦–ä¸¤ä¸ªå†³ç­– $j_1, j_2$ï¼Œå¦‚æœ $T(j_1, j_2) < 2 \times g(i)$ï¼Œåˆ™åˆ é™¤é˜Ÿé¦–å…ƒç´  $j_1$ã€‚å¦‚æ­¤å¾ªç¯ä¸‹å»ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°å°äº $2$ æˆ–è€… $T(j_1, j_2) > 2 \times g(i)$ï¼›
4. **å–å¤´**ï¼šæœ€ä¼˜å†³ç­–åœ¨é˜Ÿé¦–ã€‚

æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$ã€‚

[RECORD](https://www.luogu.com.cn/record/83528457)

```cpp
#include <bits/stdc++.h>
using namespace std;
#define LL long long
int n, L;
LL s[50050], dp[50050];
int head, tail, Q[50050];
LL x(int i) { return i+s[i-1]; }
LL y(int i) { return dp[i-1]+x(i)*x(i); }
LL g(int i) { return i+s[i]-L; }
double T(int i, int j) {
	return (double)(y(j)-y(i))/(x(j)-x(i)); 
}
LL cost(int i, int j) {
	return abs((j-i+s[j]-s[i-1]-L)*(j-i+s[j]-s[i-1]-L));
}
int main()
{
	cin >> n >> L;
	for (int i = 1; i <= n; i++) {
		cin >> s[i];
		s[i] += s[i-1];
	}
	head = 1;
	tail = 0;
	for (int i = 1; i <= n; i++) {
		while (head <= tail-1 && T(Q[tail-1], Q[tail]) > T(Q[tail], i)) tail--;
		Q[++tail] = i;
		while (head <= tail-1 && T(Q[head], Q[head+1]) < 2*g(i)) head++;
		dp[i] = dp[Q[head]-1]+cost(Q[head], i);
	}
	cout << dp[n] << endl;
	return 0;
}
```

## ä¾‹é¢˜ [APIO2010] ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿ

[Luogu](https://www.luogu.com.cn/problem/P3628) [LOJ](https://loj.ac/p/10190)

### é¢˜ç›®æè¿°

ä½ æœ‰ä¸€æ”¯ç”± $n$ åé¢„å¤‡å½¹å£«å…µç»„æˆçš„éƒ¨é˜Ÿï¼Œå£«å…µä» $1$ åˆ° $n$ ç¼–å·ï¼Œä½ è¦å°†ä»–ä»¬æ‹†åˆ†æˆè‹¥å¹²ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿè°ƒå…¥æˆ˜åœºã€‚å‡ºäºé»˜å¥‘çš„è€ƒè™‘ï¼ŒåŒä¸€æ”¯ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿä¸­é˜Ÿå‘˜çš„ç¼–å·**åº”è¯¥è¿ç»­**ï¼Œå³ä¸ºå½¢å¦‚ $(i, i + 1, \cdots i + k)$çš„åºåˆ—ã€‚æ‰€æœ‰çš„é˜Ÿå‘˜éƒ½åº”è¯¥å±äºä¸”ä»…å±äºä¸€æ”¯ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿã€‚

ç¼–å·ä¸º $i$ çš„å£«å…µçš„åˆå§‹æˆ˜æ–—åŠ›ä¸º $x_i$ ï¼Œä¸€æ”¯ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿçš„åˆå§‹æˆ˜æ–—åŠ› $X$ ä¸ºé˜Ÿå†…å£«å…µåˆå§‹æˆ˜æ–—åŠ›ä¹‹å’Œï¼Œå³ $X = x_i + x_{i+1} + \cdots + x_{i+k}$ã€‚

é€šè¿‡é•¿æœŸçš„è§‚å¯Ÿï¼Œä½ æ€»ç»“å‡ºå¯¹äºä¸€æ”¯åˆå§‹æˆ˜æ–—åŠ›ä¸º $X$ çš„ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿï¼Œå…¶ä¿®æ­£æˆ˜æ–—åŠ› $X'= aX^2+bX+c$ï¼Œå…¶ä¸­ $a,~b,~c$ æ˜¯å·²çŸ¥çš„ç³»æ•°ï¼ˆ$a < 0$ï¼‰ã€‚ ä½œä¸ºéƒ¨é˜Ÿç»Ÿå¸…ï¼Œç°åœ¨ä½ è¦ä¸ºè¿™æ”¯éƒ¨é˜Ÿè¿›è¡Œç¼–é˜Ÿï¼Œä½¿å¾—æ‰€æœ‰ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿçš„ä¿®æ­£æˆ˜æ–—åŠ›ä¹‹å’Œæœ€å¤§ã€‚è¯•æ±‚å‡ºè¿™ä¸ªæœ€å¤§å’Œã€‚

$1 \leq n \leq 10^6$ï¼Œ$-5 \leq a \leq -1$ï¼Œ$-10^7 \leq b \leq 10^7$ï¼Œ$-10^7 \leq c \leq 10^7$ï¼Œ$1 \leq x_i \leq 100$ã€‚

### åˆ†æ

ä»¤ $f(i)$ è¡¨ç¤ºæŠŠå‰ $i$ ä¸ªå£«å…µç¼–é˜Ÿçš„æœ€å¤§ä¿®æ­£æˆ˜æ–—åŠ›ä¹‹å’Œï¼Œ$s(i)$ è¡¨ç¤º $x_i$ çš„å‰ç¼€å’Œã€‚

å‡å¦‚å°†å£«å…µ $j$ åˆ° $i$ ç¼–åœ¨åŒä¸€é˜Ÿï¼Œå¾—å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ $f(i) = \max_{1\le j\le i}\{f(j-1) + a\times (s(i)-s(j-1))^2 + b\times (s(i)-s(j-1)) + c\}$ã€‚

å±•å¼€åå¾—å‡º

$$
f(i) = \max_{1\le j\le i}\{f(j-1) + a \times s(i)^2 + a \times s(j-1)^2 - 2a \times s(i) \times s(j-1) + b \times s(i) - b \times s(j-1) + c \}
\\
f(i) = \max_{1\le j\le i}\{f(j-1) + a \times (s(i)^2 + s(j-1)^2) - 2a \times s(i) \times s(j-1) + b \times (s(i) - s(j-1)) + c \}
$$

**ç ”ç©¶ $j_2 > j_1$ æ—¶ $f(i)_{j_{2}} > f(i)_{j_{1}}$ å³ã€Œå†³ç­– $j_2$ ä¼˜äº å†³ç­– $j_1$ã€çš„å‰ææ¡ä»¶**ï¼š

$$
f(j_2-1) + a \times (s(i)^2 + s(j_2-1)^2) - 2a \times s(i) \times s(j_2-1) + b \times (s(i) - s(j_2-1)) + c > f(j_1-1) + a \times (s(i)^2 + s(j_1-1)^2) - 2a \times s(i) \times s(j_1-1) + b \times (s(i) - s(j_1-1)) + c
\\
f(j_2-1) - f(j_1-1) + a \times (s(i_2-1)^2 - s(j_1-1)^2) - b \times (s(j_2-1) - s(j_1-1)) > 2a \times s(i) \times (s(j_2-1) - s(j_1-1))
\\
\frac{f(j_2-1) - f(j_1-1) + a \times (s(i_2-1)^2 - s(j_1-1)^2) - b \times (s(j_2-1) - s(j_1-1))}{s(j_2-1) - s(j_1-1)} > 2a \times s(i)
$$

ä»¤ $g(i) = f(i-1) + a \times s(i-1)^2 - b \times s(i-1)$ï¼Œåˆ™æœ‰

$$
\frac{g(j_2)-g(j_1)}{s(j_2-1) - s(j_1-1)} > 2a \times s(i)
$$

ä¸Šé¢å¼å­å°±æ˜¯ $(s(j_1-1), g(j_1)), (s(j_2-1), g(j_2))$ ä¸¤ä¸ªç‚¹å½¢æˆçš„æ–œç‡ã€‚

å°ç»“ï¼šè®¡ç®— $f(i)$ æ—¶ï¼Œå¯é€‰å†³ç­– $j_2 > j_1$ï¼Œä»¤ $T(j_1, j_2)=\frac{g(j_2)-g(j_1)}{s(j_2-1) - s(j_1-1)}$ï¼Œå¦‚æœ $j_2$ æ¯” $j_1$ ä¼˜ï¼Œå¿…é¡»æ»¡è¶³ $T(j_1, j_2) > 2a \times s(i)$ã€‚

è¯¥é¢˜ $s(i)$ å•è°ƒå¢ï¼Œå¯ä»¥å¾—å‡ºä¸¤ä¸ªç»“è®ºï¼š

1. è®¡ç®— $f(i)$ æ—¶ï¼Œå¯ä»¥åˆ é™¤å†—ä½™å†³ç­–ï¼Œä½¿å¾—é˜Ÿåˆ—ä¸­ä»å°åˆ°å¤§ä¾æ¬¡å­˜å‚¨æœ‰ä»·å€¼çš„å¯é€‰å†³ç­– $j_1, j_2, \cdots, j_k$ï¼Œä½¿å¾—è¿™äº›ç›¸é‚»å†³ç­–ä¹‹é—´çš„æ–œç‡éƒ½è¦å°äº $2a \times s(i)$ã€‚å³ï¼š $T(j_1, j_2) < 2a \times s(i), T(j_2, j_3) < 2a \times s(i), \cdots, T(j_{k-1}, j_k) < 2a \times s(i)$ã€‚æœ€ä¼˜å†³ç­–æ˜¯é˜Ÿé¦–å…ƒç´  $j_1$ã€‚

    è¯æ˜ï¼šå¯¹äºé˜Ÿåˆ—ä¸­ä¸¤ä¸ªç›¸é‚»å†³ç­– $x, y$ï¼Œå¦‚æœ $T(x, y) > 2a \times s(i)$ï¼Œç”±äº $s(i)$ å•è°ƒå¢ï¼Œä¸”é¢˜ç›®ä¸­è§„å®š $a < 0$ï¼Œæ‰€ä»¥ $2a \times s(i)$ å•è°ƒä¸‹é™ï¼Œæ‰€ä»¥å¯¹äº $i_1 > i$ æœ‰ $T(x, y) > 2a \times s(i) > 2a \times s(i_1)$ï¼Œ$y$ æ°¸è¿œæ¯” $x$ ä¼˜ï¼Œæ‰€ä»¥ $x$ å¯ä»¥åˆ é™¤ã€‚æ‰€ä»¥ $T(j_1, j_2) < 2a \times s(i), T(j_2, j_3) < 2a \times s(i), \cdots, T(j_{k-1}, j_k) < 2a \times s(i)$ï¼Œ$j_1$ æ¯” $j_2$ ä¼˜ï¼Œ$j_2$ æ¯” $j_3$ ä¼˜ï¼Œ...ï¼Œ$j_k-1$ æ¯” $j_k$ ä¼˜ã€‚æ‰€ä»¥é˜Ÿé¦–å…ƒç´  $j_1$ æ˜¯æœ€ä¼˜çš„ã€‚

2. å¯ä»¥ç»´æŠ¤ç›¸é‚»å†³ç­–ä¹‹é—´çš„æ–œç‡å•è°ƒå‡ã€‚

    è¯æ˜ï¼šè®¾é˜Ÿåˆ—ä¸­ä¸‰ä¸ªç›¸é‚»å†³ç­– $j_1, j_2, j_3$ï¼Œå‡è®¾å‡ºç°å•è°ƒå¢å³ $T(j_1, j_2) < T(j_2, j_3)$ï¼Œåˆ†æ $j_2$ æœ‰æ²¡æœ‰å¯èƒ½æˆä¸ºæœ€ä¼˜å†³ç­–ã€‚

    $$
    j_2 æ¯” j_1 ä¼˜ \Rightarrow T(j_1, j_2) > 2a \times s(i)
    \\
    j_2 æ¯” j_3 ä¼˜ \Rightarrow T(j_2, j_3) < 2a \times s(i)
    \\
    T(j_2, j_3) < 2a \times s(i) < T(j_1, j_2)
    $$

    çŸ›ç›¾ã€‚$j_2$ ä¸å¯èƒ½æˆä¸ºæœ€ä¼˜å†³ç­–ï¼Œå¯ä»¥åˆ é™¤ã€‚å¾—è¯ã€‚

ç»¼ä¸Šï¼š

1. åº”è¯¥ç»´æŠ¤é˜Ÿåˆ—ä¸­ç›¸é‚»å†³ç­–æ»¡è¶³ï¼š$T(j_1, j_2) > T(j_2, j_3) > \cdots > T(j_{k-1}, j_k) > 2a \times s(i)$ã€‚
2. æœ€ä¼˜å†³ç­–å–é˜Ÿé¦–å…ƒç´ ã€‚

[RECORD](https://www.luogu.com.cn/record/83587373)

```cpp
#include <bits/stdc++.h>
using namespace std;
#define LL long long
int n;
LL a, b, c;
int st, en, Q[1000006];
LL s[1000006], dp[1000006];
LL g(int i) {
    return dp[i - 1] + a * s[i - 1] * s[i - 1] - b * s[i - 1];
}
double T(int i, int j) {
    return (g(j) - g(i)) * 1.0 / (s[j - 1] - s[i - 1]) * 1.0;
}
LL cost(int i, int j) {
    return a * (s[i] - s[j - 1]) * (s[i] - s[j - 1]) + b * (s[i] - s[j - 1]) + c;
}
int main() {
    cin >> n >> a >> b >> c;
    for (int i = 1; i <= n; i++) {
        cin >> s[i];
        s[i] += s[i - 1];
    }
    st = 1;
    en = 0;
    for (int i = 1; i <= n; i++) {
        while (st <= en - 1 && T(Q[en - 1], Q[en]) <= T(Q[en], i))
            en--;
        Q[++en] = i;
        while (st <= en - 1 && T(Q[st], Q[st + 1]) >= 2 * a * s[i])
            st++;
        dp[i] = dp[Q[st] - 1] + cost(i, Q[st]);
    }
    cout << dp[n] << endl;
    return 0;
}
```

**å®ç°æ—¶è¦æ³¨æ„**ï¼šåœ¨è®¡ç®—æ–œç‡çš„å‡½æ•° `double T()` ä¸­ï¼Œä¸€å®šè¦ç”¨ `(double)` æˆ–è€… `*1.0`ï¼Œå°† `long long` å˜æˆ `double` ç±»å‹ä¹‹åå†è®¡ç®—ï¼ï¼ï¼ï¼ï¼

**å®ç°æ—¶è¦æ³¨æ„**ï¼šåœ¨è®¡ç®—æ–œç‡çš„å‡½æ•° `double T()` ä¸­ï¼Œä¸€å®šè¦ç”¨ `(double)` æˆ–è€… `*1.0`ï¼Œå°† `long long` å˜æˆ `double` ç±»å‹ä¹‹åå†è®¡ç®—ï¼ï¼ï¼ï¼ï¼

**å®ç°æ—¶è¦æ³¨æ„**ï¼šåœ¨è®¡ç®—æ–œç‡çš„å‡½æ•° `double T()` ä¸­ï¼Œä¸€å®šè¦ç”¨ `(double)` æˆ–è€… `*1.0`ï¼Œå°† `long long` å˜æˆ `double` ç±»å‹ä¹‹åå†è®¡ç®—ï¼ï¼ï¼ï¼ï¼

------

è‡´è°¢ï¼š

- lgj

ğŸ™‡â€
